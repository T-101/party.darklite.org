{% extends 'party/base.html' %}{% load crispy_forms_tags %}{% load countries %}

{% block title %}
    <title>Create a new party | Darklite Partywiki</title>
    <meta property="og:title" content="Create a new party | Darklite Partywiki"/>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <h3>Add a party</h3>
                {% crispy form %}
                <p>Fields with (*) are mandatory</p>
            </div>
            {% if parties %}
                <div class="col-sm-6">
                    <h3>Or generate from <a href="https://www.demoparty.net/">demoparty.net</a></h3>
                    <ul style="list-style: none">
                        {% for party in parties %}
                            {% get_country party.2 as country %}
                            <li>
                                <img src="/static/flags/{{ party.2|lower }}.gif"
                                     height="10" title="{{ country.name }}"
                                     alt="Flag: {{ country.name }}"
                                     onerror="this.style.display='none'">&nbsp;
                                <a class="createPartyLink"
                                   href="{% url 'party:demopartynet-create' %}?slug={{ party.0|slugify }}">{{ party.0 }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="spinnerModal" data-backdrop="static" data-keyboard="false"
         tabindex="-1" aria-labelledby="spinnerModalLabel" aria-hidden="true">
        <div class="modal-dialog h-100 d-flex flex-column justify-content-center my-0">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="spinnerModalLabel">Just a moment...</h5>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-2 my-auto">
                            <div class="spinner-border float-right" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>
                        <div class="col my-auto">
                            Fetching data from demoparty.net
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $("#id_date_start").on("change.datetimepicker", e => {
            $("#id_date_end").val(e.target.value)
        })
        $(".createPartyLink").click(() => $("#spinnerModal").modal("show"))
    </script>
{% endblock %}
